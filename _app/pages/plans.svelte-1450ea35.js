import{Y as L,S as C,i as J,s as M,e as b,c as v,a as E,d as h,b as d,f as g,k as D,t as z,n as I,g as Q,H as j,O as W,N as X,l as x,W as B,X as H,I as N,A as R}from"../chunks/vendor-8d9394b1.js";import{u as U,w as V,s as O}from"../chunks/constants-70738a96.js";import{b as P}from"../chunks/paths-28a87002.js";function q(n,s,t){const a=n.slice();return a[11]=s[t],a}function A(n){let s,t=n[2],a=[];for(let l=0;l<t.length;l+=1)a[l]=S(q(n,t,l));return{c(){s=b("div");for(let l=0;l<a.length;l+=1)a[l].c();this.h()},l(l){s=v(l,"DIV",{class:!0});var i=E(s);for(let e=0;e<a.length;e+=1)a[e].l(i);i.forEach(h),this.h()},h(){d(s,"class","controls svelte-1ve7sum")},m(l,i){g(l,s,i);for(let e=0;e<a.length;e+=1)a[e].m(s,null)},p(l,i){if(i&6){t=l[2];let e;for(e=0;e<t.length;e+=1){const p=q(l,t,e);a[e]?a[e].p(p,i):(a[e]=S(p),a[e].c(),a[e].m(s,null))}for(;e<a.length;e+=1)a[e].d(1);a.length=t.length}},d(l){l&&h(s),X(a,l)}}}function S(n){let s,t,a,l=V(n[11])+"",i,e,p,c;return{c(){s=b("label"),t=b("input"),a=D(),i=z(l),e=D(),this.h()},l(o){s=v(o,"LABEL",{class:!0});var r=E(s);t=v(r,"INPUT",{type:!0,name:!0}),a=I(r),i=Q(r,l),e=I(r),r.forEach(h),this.h()},h(){d(t,"type","radio"),d(t,"name","plans"),t.__value=n[11],t.value=t.__value,n[8][0].push(t),d(s,"class","svelte-1ve7sum")},m(o,r){g(o,s,r),j(s,t),t.checked=t.__value===n[1],j(s,a),j(s,i),j(s,e),p||(c=W(t,"change",n[7]),p=!0)},p(o,r){r&2&&(t.checked=t.__value===o[1])},d(o){o&&h(s),n[8][0].splice(n[8][0].indexOf(t),1),p=!1,c()}}}function Z(n){let s,t,a,l,i,e,p,c=n[0]&&A(n);return{c(){s=b("link"),t=b("script"),l=D(),i=b("div"),e=D(),c&&c.c(),p=x(),this.h()},l(o){const r=B('[data-svelte="svelte-1p75gtx"]',document.head);s=v(r,"LINK",{href:!0,rel:!0}),t=v(r,"SCRIPT",{src:!0});var y=E(t);y.forEach(h),r.forEach(h),l=I(o),i=v(o,"DIV",{id:!0,class:!0}),E(i).forEach(h),e=I(o),c&&c.l(o),p=x(),this.h()},h(){d(s,"href","https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.css"),d(s,"rel","stylesheet"),H(t.src,a="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js")||d(t,"src",a),d(i,"id","map"),d(i,"class","svelte-1ve7sum")},m(o,r){j(document.head,s),j(document.head,t),g(o,l,r),g(o,i,r),g(o,e,r),c&&c.m(o,r),g(o,p,r)},p(o,[r]){o[0]?c?c.p(o,r):(c=A(o),c.c(),c.m(p.parentNode,p)):c&&(c.d(1),c=null)},i:N,o:N,d(o){h(s),h(t),o&&h(l),o&&h(i),o&&h(e),c&&c.d(o),o&&h(p)}}}async function te({fetch:n}){const s=await n(`${P}/plans.topojson`),a=await(await n(`${P}/output_census_wgs84.topojson`)).json(),l=U(a.objects.census),i=L(a,l);return{props:{topoData:await s.json(),census:i}}}const w="pop20",K="pop";function Y(n,s,t){let{topoData:a,census:l,points:i}=s,e,p;const c=["assembly","assembly_letters","assembly_names","assembly_unity","senate","senate_letters","senate_names","senate_unity"],o={pop:[0,.1,.2,.4,.6],cvap:[0,.1,.2,.4,.6]};function r({properties:u}){if(!u.ALAND||u[`${w}_total`]<=10)return"rgba(0, 0, 0, 0)";const f=m=>u[`${w}_${m}`]/u[`${w}_total`],k=o[K];for(let m=1;m<k.length;m++)if(f("asian")<k[m])return O[m-1];return O[k.length-1]}R(()=>{mapboxgl.accessToken="pk.eyJ1IjoianNvbmthbyIsImEiOiJjanNvM2U4bXQwN2I3NDRydXQ3Z2kwbWQwIn0.JWAoBlcpDJwkzG-O5_r0ZA",t(6,e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jsonkao/ckvnu5tpy6coj14uizvyf1wuf/draft",center:[-73.967,40.72],zoom:12})),e.on("load",async()=>{const u=e.getStyle().layers;e.addSource("census",{type:"geojson",data:l});const _=["match",["get","GEOID"]];l.features.forEach(f=>{_.push(f.properties.GEOID,r(f))}),_.push("rgba(0, 0, 0, 0)"),e.addLayer({id:"census",type:"fill",source:"census",paint:{"fill-color":_}},"parks"),console.log(u),c.forEach(f=>{const k=L(a,a.objects[f]);e.addSource(f,{type:"geojson",data:k}),e.addLayer({id:f+"_outline",type:"line",source:f,layout:{},paint:{"line-color":"#000","line-width":1}}),e.addLayer({id:f+"_fill",type:"fill",source:f,layout:{},paint:{"fill-color":"#000000","fill-opacity":0}}),e.on("click",f+"_fill",m=>{new mapboxgl.Popup().setLngLat(m.lngLat).setHTML(m.features[0].properties[f]).addTo(e)})}),t(0,p=!0)})});let y;const G=[[]];function T(){y=this.__value,t(1,y)}return n.$$set=u=>{"topoData"in u&&t(3,a=u.topoData),"census"in u&&t(4,l=u.census),"points"in u&&t(5,i=u.points)},n.$$.update=()=>{if(n.$$.dirty&67&&p&&c.forEach(u=>{const _=u===y?"visible":"none";e.setLayoutProperty(`${u}_outline`,"visibility",_),e.setLayoutProperty(`${u}_fill`,"visibility",_)}),n.$$.dirty&81&&p){const u=["match",["get","GEOID"]];l.features.forEach(_=>{u.push(_.properties.GEOID,r(_))}),u.push("rgba(0, 0, 0, 0)"),e.setPaintProperty("census","fill-color",u)}},[p,y,c,a,l,i,e,T,G]}class se extends C{constructor(s){super();J(this,s,Y,Z,M,{topoData:3,census:4,points:5})}}export{se as default,te as load};
