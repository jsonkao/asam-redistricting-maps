import{a1 as L,S as C,i as J,s as M,e as y,c as v,a as w,d as _,b as m,f as g,k as D,t as G,n as E,g as Q,H as j,N as V,V as B,l as x,ab as H,ac as R,I as N,A as U}from"../chunks/vendor-10aa861a.js";import{u as W,z as X,s as q}from"../chunks/constants-eb34db63.js";import{b as A}from"../chunks/paths-28a87002.js";function P(i,s,t){const a=i.slice();return a[11]=s[t],a}function S(i){let s,t=i[2],a=[];for(let l=0;l<t.length;l+=1)a[l]=O(P(i,t,l));return{c(){s=y("div");for(let l=0;l<a.length;l+=1)a[l].c();this.h()},l(l){s=v(l,"DIV",{class:!0});var n=w(s);for(let e=0;e<a.length;e+=1)a[e].l(n);n.forEach(_),this.h()},h(){m(s,"class","controls svelte-1ve7sum")},m(l,n){g(l,s,n);for(let e=0;e<a.length;e+=1)a[e].m(s,null)},p(l,n){if(n&6){t=l[2];let e;for(e=0;e<t.length;e+=1){const u=P(l,t,e);a[e]?a[e].p(u,n):(a[e]=O(u),a[e].c(),a[e].m(s,null))}for(;e<a.length;e+=1)a[e].d(1);a.length=t.length}},d(l){l&&_(s),B(a,l)}}}function O(i){let s,t,a,l=X(i[11])+"",n,e,u,c;return{c(){s=y("label"),t=y("input"),a=D(),n=G(l),e=D(),this.h()},l(o){s=v(o,"LABEL",{class:!0});var r=w(s);t=v(r,"INPUT",{type:!0,name:!0}),a=E(r),n=Q(r,l),e=E(r),r.forEach(_),this.h()},h(){m(t,"type","radio"),m(t,"name","plans"),t.__value=i[11],t.value=t.__value,i[8][0].push(t),m(s,"class","svelte-1ve7sum")},m(o,r){g(o,s,r),j(s,t),t.checked=t.__value===i[1],j(s,a),j(s,n),j(s,e),u||(c=V(t,"change",i[7]),u=!0)},p(o,r){r&2&&(t.checked=t.__value===o[1])},d(o){o&&_(s),i[8][0].splice(i[8][0].indexOf(t),1),u=!1,c()}}}function Z(i){let s,t,a,l,n,e,u,c=i[0]&&S(i);return{c(){s=y("link"),t=y("script"),l=D(),n=y("div"),e=D(),c&&c.c(),u=x(),this.h()},l(o){const r=H('[data-svelte="svelte-1p75gtx"]',document.head);s=v(r,"LINK",{href:!0,rel:!0}),t=v(r,"SCRIPT",{src:!0});var b=w(t);b.forEach(_),r.forEach(_),l=E(o),n=v(o,"DIV",{id:!0,class:!0}),w(n).forEach(_),e=E(o),c&&c.l(o),u=x(),this.h()},h(){m(s,"href","https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.css"),m(s,"rel","stylesheet"),R(t.src,a="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js")||m(t,"src",a),m(n,"id","map"),m(n,"class","svelte-1ve7sum")},m(o,r){j(document.head,s),j(document.head,t),g(o,l,r),g(o,n,r),g(o,e,r),c&&c.m(o,r),g(o,u,r)},p(o,[r]){o[0]?c?c.p(o,r):(c=S(o),c.c(),c.m(u.parentNode,u)):c&&(c.d(1),c=null)},i:N,o:N,d(o){_(s),_(t),o&&_(l),o&&_(n),o&&_(e),c&&c.d(o),o&&_(u)}}}async function te({fetch:i}){const s=await i(`${A}/plans.topojson`),a=await(await i(`${A}/output_census_wgs84.topojson`)).json(),l=W(a.objects.census),n=L(a,l);return{props:{topoData:await s.json(),census:n}}}const I="pop20",K="pop";function F(i,s,t){let{topoData:a,census:l,points:n}=s,e,u;const c=["assembly","assembly_letters","assembly_names","assembly_unity","senate","senate_letters","senate_names","senate_unity"],o={pop:[0,.1,.2,.4,.6],cvap:[0,.1,.2,.4,.6]};function r({properties:p}){if(!p.ALAND||p[`${I}_total`]<=10)return"rgba(0, 0, 0, 0)";const f=h=>p[`${I}_${h}`]/p[`${I}_total`],k=o[K];for(let h=1;h<k.length;h++)if(f("asian")<k[h])return q[h-1];return q[k.length-1]}U(()=>{mapboxgl.accessToken="pk.eyJ1IjoianNvbmthbyIsImEiOiJjanNvM2U4bXQwN2I3NDRydXQ3Z2kwbWQwIn0.JWAoBlcpDJwkzG-O5_r0ZA",t(6,e=new mapboxgl.Map({container:"map",style:"mapbox://styles/jsonkao/ckvnu5tpy6coj14uizvyf1wuf/draft",center:[-73.967,40.72],zoom:12})),e.on("load",async()=>{const p=e.getStyle().layers;e.addSource("census",{type:"geojson",data:l});const d=["match",["get","GEOID"]];l.features.forEach(f=>{d.push(f.properties.GEOID,r(f))}),d.push("rgba(0, 0, 0, 0)"),e.addLayer({id:"census",type:"fill",source:"census",paint:{"fill-color":d}},"parks"),console.log(p),c.forEach(f=>{const k=L(a,a.objects[f]);e.addSource(f,{type:"geojson",data:k}),e.addLayer({id:f+"_outline",type:"line",source:f,layout:{},paint:{"line-color":"#000","line-width":1}}),e.addLayer({id:f+"_fill",type:"fill",source:f,layout:{},paint:{"fill-color":"#000000","fill-opacity":0}}),e.on("click",f+"_fill",h=>{new mapboxgl.Popup().setLngLat(h.lngLat).setHTML(h.features[0].properties[f]).addTo(e)})}),t(0,u=!0)})});let b;const T=[[]];function z(){b=this.__value,t(1,b)}return i.$$set=p=>{"topoData"in p&&t(3,a=p.topoData),"census"in p&&t(4,l=p.census),"points"in p&&t(5,n=p.points)},i.$$.update=()=>{i.$$.dirty&67&&u&&c.forEach(p=>{const d=p===b?"visible":"none";e.setLayoutProperty(`${p}_outline`,"visibility",d),e.setLayoutProperty(`${p}_fill`,"visibility",d)})},[u,b,c,a,l,n,e,z,T]}class se extends C{constructor(s){super();J(this,s,F,Z,M,{topoData:3,census:4,points:5})}}export{se as default,te as load};
